# Blue Mountain Travel - Security Vulnerabilities Guide

## ðŸš© CTF Flags and Vulnerabilities

This document provides a comprehensive guide to all intentional security vulnerabilities and CTF flags in the Blue Mountain Travel application.

## Table of Contents

1. [Overview](#overview)
2. [User Enumeration & Password Spraying](#user-enumeration--password-spraying)
3. [Authentication Vulnerabilities](#authentication-vulnerabilities)
4. [Azure Storage Exposure](#azure-storage-exposure)
5. [Passport Data Leakage](#passport-data-leakage)
6. [Employee Database Exposure](#employee-database-exposure)
7. [Lateral Movement Paths](#lateral-movement-paths)
8. [Admin Panel Access](#admin-panel-access)
9. [All CTF Flags](#all-ctf-flags)

---

## Overview

Blue Mountain Travel is an intentionally vulnerable travel agency application designed for security training. It contains multiple attack vectors including user enumeration, password spraying, insecure storage, and privilege escalation opportunities.

**Base URL**: http://localhost:8080

---

## User Enumeration & Password Spraying

### Vulnerability: Anonymous User Enumeration
- **Location**: `/js/enumeration.js`
- **Functions Available**:
  - `checkUserExists(email)` - Check if email exists in system
  - `enumerateAllUsers()` - List all emails without authentication
  - `getAllAzureUsernames()` - Get all Azure/Entra usernames

### Password Spraying Endpoints

#### 1. Application Password Spray
```javascript
attemptPasswordSpray(
  ["john.smith@company.com", "sarah.johnson@enterprise.com"], 
  "password123"
)
```
**Flag**: `FLAG{password_spray_no_rate_limiting}`

#### 2. Database Password Spray
```javascript
attemptDatabasePasswordSpray(
  ["admin", "sa", "root"], 
  "P@ssw0rd123!"
)
```
**Flag**: `FLAG{sql_password_spray_vulnerable}`

#### 3. Entra ID Password Spray
```javascript
attemptEntraPasswordSpray(
  ["john.smith@bluemountain.onmicrosoft.com"],
  "Winter2024!"
)
```
**Flag**: `FLAG{entra_id_password_spray_no_protection}`

### Known Valid Credentials

**Application Users**:
- john.smith@company.com / password123
- sarah.johnson@enterprise.com / Sarah@2024
- michael.chen@startups.io / Chen#2024
- emma.w@consulting.com / Emma!Williams99
- d.martinez@finance.com / DavidM@rtinez2024
- admin@bluemountaintravel.com / Admin@BlueMountain2024!

**Database**:
- Username: admin
- Password: P@ssw0rd123!
- Server: bluemountaintravel.database.windows.net

**Azure/Entra Admin**:
- Username: admin@bluemountain.onmicrosoft.com
- Password: AzureAdmin2024!@#
- Tenant: 87654321-4321-4321-4321-210987654321

---

## Authentication Vulnerabilities

### 1. Client-Side Authentication
- **Page**: `/login.html`
- **Vulnerability**: All authentication logic in JavaScript
- **Flag**: `FLAG{client_side_authentication_bypass}`

### 2. No Rate Limiting
- **Issue**: Unlimited login attempts
- **Flag**: `FLAG{insecure_login_form_no_rate_limiting}`

### 3. User Existence Disclosure
- **Issue**: Different error messages for valid/invalid users
- **Flag**: `FLAG{enumerate_all_users_no_auth}`

### 4. Plain Text Passwords
- **Storage**: localStorage, console logs, source code
- **Flag**: `FLAG{user_pii_data_in_plain_text_storage}`

---

## Azure Storage Exposure

### Public SAS Token
**Token**: `?sv=2021-06-08&ss=bfqt&srt=sco&sp=rwdlacupiytfx&se=2025-12-31T23:59:59Z&st=2024-01-01T00:00:00Z&spr=https&sig=FakeSignatureForDemo123456789==`

**Permissions**: Full (Read, Write, Delete, List, Add, Create, Update, Process, Execute)
**Expiry**: 2025-12-31

### Accessible Containers

1. **passports** - Employee passport scans and photos
2. **profiles** - User profile data with PII
3. **bookings** - Travel booking confirmations
4. **documents** - Configuration files and credentials

### Storage Browser
- **URL**: http://localhost:8080/storage-browser.html
- **Flag**: `FLAG{storage_browser_publicly_accessible}`

### Access Commands

```bash
# List all containers
az storage container list \
  --account-name bluemountaintravel \
  --sas-token "sv=2021-06-08&ss=bfqt&srt=sco&sp=rwdlacupiytfx&se=2025-12-31..."

# Download all passports
az storage blob download-batch \
  --account-name bluemountaintravel \
  --source passports \
  --destination ./passports \
  --sas-token "..."
```

---

## Passport Data Leakage

### Passport Viewer
- **URL**: http://localhost:8080/passport-viewer.html
- **Flag**: `FLAG{passport_viewer_no_authentication}`

### Available Passports

| Employee | Passport No | Country | Photo URL |
|----------|-------------|---------|-----------|
| John Smith | US123456789 | USA | With unsplash image |
| Sarah Johnson | US234567890 | USA | With unsplash image |
| Michael Chen | CN567890123 | China | With unsplash image |
| Emma Williams | GB789012345 | UK | With unsplash image |
| David Martinez | MX890123456 | Mexico | With unsplash image |
| Admin | US000000001 | USA (Diplomatic) | With unsplash image |

### Passport Files

Each passport has:
- Full passport PDF scan
- High-resolution passport photo (JPG)
- Both accessible via public SAS token URLs

**Flags**:
- `FLAG{passport_documents_in_public_blob_storage}`
- `FLAG{passport_images_no_auth_required}`
- `FLAG{international_passports_in_public_blob}`
- `FLAG{bulk_passport_download_via_sas_token}`

---

## Employee Database Exposure

### Access Employee Data
```javascript
// Search employees
searchEmployees("john")

// Export all employee data
exportEmployeeData()

// Get privileged accounts
getPrivilegedEmployees()

// Get Azure usernames for targeting
getAllAzureUsernames()
```

### Employee Data Includes
- Full name, email, personal email
- SSN, date of birth, salary
- Home address, phone numbers
- AD username, Azure username
- Security question answers
- VPN access status, access level

**Flags**:
- `FLAG{employee_database_publicly_accessible}`
- `FLAG{employee_search_no_authentication}`
- `FLAG{employee_pii_export_without_auth}`
- `FLAG{privileged_account_list_exposed}`

---

## Lateral Movement Paths

### Path 1: Database â†’ Storage

1. Obtain database credentials (from source code or password spray)
2. Connect to SQL database
3. Query passport/booking tables with blob URLs
4. Use SAS tokens from database to download files

```javascript
lateralMovementFromDatabase()
```
**Flag**: `FLAG{lateral_movement_database_to_storage}`

### Path 2: Service Principal â†’ Key Vault â†’ Storage

1. Find app-registrations.json in documents container
2. Extract service principal credentials:
   - App ID: a1b2c3d4-e5f6-7890-abcd-ef1234567890
   - Secret: SuperSecret123!@#$%
3. Use service principal to access Key Vault
4. Retrieve storage account keys from Key Vault
5. Full access to all storage containers

```javascript
accessPassportsViaKeyVault()
```
**Flag**: `FLAG{key_vault_to_storage_lateral_movement}`

### App Registration File
**URL**: http://localhost:8080/app-registrations.json
**Contains**:
- Service principal credentials
- Azure subscription details
- Key Vault access information
- Azure CLI commands with credentials

**Flags**:
- `FLAG{app_registration_credentials_in_public_storage}`
- `FLAG{service_principal_full_contributor_access}`
- `FLAG{azure_cli_commands_with_credentials}`

---

## Admin Panel Access

### URL
http://localhost:8080/admin.html

### Vulnerabilities
- No authentication required
- All credentials displayed in plain text
- Full user data export functionality
- Azure subscription access exposed

### Admin Functions
```javascript
showAzureCredentials()
showConnectionString()
viewAllUsers()
exportUserData()
showSASToken()
showServicePrincipalDetails()
```

### Exposed Information
- Azure Subscription ID
- Tenant ID
- Database connection strings
- Service principal secrets
- Storage SAS tokens
- API keys
- Entra ID global admin credentials

**Flags**:
- `FLAG{admin_panel_without_authentication}`
- `FLAG{admin_panel_accessible_without_auth}`
- `FLAG{exposed_azure_subscription_credentials}`
- `FLAG{database_credentials_in_admin_panel}`
- `FLAG{entra_global_admin_credentials_exposed}`
- `FLAG{service_principal_can_access_all_azure_resources}`

---

## All CTF Flags

### Source Code Flags
1. `FLAG{exposed_flight_data_in_client_side_code}`
2. `FLAG{hotel_details_exposed_client_side}`
3. `FLAG{user_pii_data_in_plain_text_storage}`
4. `FLAG{azure_credentials_john_smith}`
5. `FLAG{admin_password_found}`
6. `FLAG{azure_admin_access_key_exposed}`
7. `FLAG{all_user_data_accessible_via_window_object}`

### Authentication Flags
8. `FLAG{client_side_authentication_bypass}`
9. `FLAG{insecure_login_form_no_rate_limiting}`
10. `FLAG{api_endpoint_exposed_in_source}`
11. `FLAG{all_registration_data_logged_to_console}`
12. `FLAG{insecure_registration_accepts_any_data}`
13. `FLAG{registration_endpoint_no_verification}`
14. `FLAG{predictable_session_token_generation}`
15. `FLAG{admin_console_output_reveals_secrets}`

### Enumeration & Password Spray Flags
16. `FLAG{user_enumeration_endpoint_exposed}`
17. `FLAG{password_spray_no_rate_limiting}`
18. `FLAG{sql_password_spray_vulnerable}`
19. `FLAG{entra_id_password_spray_no_protection}`
20. `FLAG{enumerate_all_users_no_auth}`
21. `FLAG{azure_username_list_for_password_spray}`

### Admin Panel Flags
22. `FLAG{admin_panel_without_authentication}`
23. `FLAG{admin_panel_accessible_without_auth}`
24. `FLAG{admin_key_exposed_in_panel}`
25. `FLAG{database_credentials_in_admin_panel}`
26. `FLAG{exposed_azure_subscription_credentials}`
27. `FLAG{entra_global_admin_credentials_exposed}`
28. `FLAG{service_principal_can_access_all_azure_resources}`
29. `FLAG{all_admin_credentials_logged_to_console}`
30. `FLAG{api_keys_accessible_to_admin}`

### Storage & Passport Flags
31. `FLAG{passport_data_in_public_blob_storage}`
32. `FLAG{passport_documents_in_public_blob_storage}`
33. `FLAG{passport_container_sas_token_exposed}`
34. `FLAG{passport_viewer_no_authentication}`
35. `FLAG{passport_images_no_auth_required}`
36. `FLAG{international_passports_in_public_blob}`
37. `FLAG{bulk_passport_download_via_sas_token}`
38. `FLAG{admin_diplomatic_passport_exposed}`
39. `FLAG{admin_diplomatic_passport_with_photo}`
40. `FLAG{storage_browser_publicly_accessible}`
41. `FLAG{storage_browser_exposes_sas_token}`
42. `FLAG{all_passport_urls_with_sas_tokens_logged}`

### App Registration & Service Principal Flags
43. `FLAG{app_registration_credentials_in_public_storage}`
44. `FLAG{service_principal_full_contributor_access}`
45. `FLAG{database_access_via_service_principal}`
46. `FLAG{api_key_in_config_file}`
47. `FLAG{azure_cli_commands_with_credentials}`

### Employee Database Flags
48. `FLAG{employee_database_publicly_accessible}`
49. `FLAG{employee_search_no_authentication}`
50. `FLAG{employee_pii_export_without_auth}`
51. `FLAG{privileged_account_list_exposed}`

### Lateral Movement Flags
52. `FLAG{lateral_movement_database_to_storage}`
53. `FLAG{key_vault_to_storage_lateral_movement}`
54. `FLAG{sas_token_with_full_permissions_until_2025}`

### Hotel Detail Flags
55. `FLAG{idor_vulnerability_in_hotel_details}`
56. `FLAG{internal_hotel_data_exposed_in_ui}`
57. `FLAG{hotel_detail_page_with_insecure_direct_object_reference}`

### Miscellaneous Flags
58. `FLAG{all_user_pii_dumped_including_passwords}`
59. `FLAG{user_data_export_contains_everything}`
60. `FLAG{downloading_files_with_sas_token}`

---

## Quick Start Guide

1. Start the application:
   ```bash
   npm install
   npm start
   ```

2. Open browser to http://localhost:8080

3. Key pages to explore:
   - `/login.html` - Vulnerable authentication
   - `/admin.html` - Exposed admin panel
   - `/passport-viewer.html` - Passport images
   - `/storage-browser.html` - Azure storage access
   - `/hotel-detail.html?id=HT001` - IDOR vulnerability

4. Open browser console (F12) and explore:
   - `window.sampleUsers` - All user data
   - `enumerateAllUsers()` - List all emails
   - `attemptPasswordSpray([...], "...")` - Test password spraying
   - `exportEmployeeData()` - Get employee PII
   - `listAllPassportUrls()` - Get passport download URLs

---

## Training Exercises

1. **Reconnaissance**: Find all exposed credentials in source code
2. **Password Spraying**: Use enumeration to build target list, then spray
3. **Lateral Movement**: Chain vulnerabilities (DB â†’ Storage â†’ Key Vault)
4. **Privilege Escalation**: Find admin credentials and access admin panel
5. **Data Exfiltration**: Download all passports and employee data
6. **Service Principal Abuse**: Use app registration to access Azure resources

---

**Remember**: This is an intentionally vulnerable application for training purposes only!

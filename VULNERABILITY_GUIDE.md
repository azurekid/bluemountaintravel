# Blue Mountain Travel - Security Vulnerabilities Guide

## ðŸš© CTF Flags and Vulnerabilities

This document provides a comprehensive guide to all intentional security vulnerabilities and CTF flags in the Blue Mountain Travel application.

## How Flags Work (2026)

To make flags less obvious in documentation, this repo no longer publishes raw flag strings.
Instead, you will find `ctf_b64: <base64>` markers in source code, HTML comments, logs, and documents.
Decode the base64 payload to recover the underlying flag value.

> **ðŸ“š Related Documentation:**
> - **[Complete Vulnerabilities Reference](docs/VULNERABILITIES_REFERENCE.md)** - Comprehensive catalog of all 68 vulnerabilities with technical details and remediation
> - **[Azure Resources Data Map](docs/AZURE_RESOURCES_DATA_MAP.md)** - Complete mapping of Azure resources and data storage locations
> - **[Security Guide](docs/SECURITY_GUIDE.md)** - Detailed security analysis and best practices

## Table of Contents

1. [Overview](#overview)
2. [User Enumeration & Password Spraying](#user-enumeration--password-spraying)
3. [Authentication Vulnerabilities](#authentication-vulnerabilities)
4. [Azure Storage Exposure](#azure-storage-exposure)
5. [Passport Data Leakage](#passport-data-leakage)
6. [Employee Database Exposure](#employee-database-exposure)
7. [Lateral Movement Paths](#lateral-movement-paths)
8. [Admin Panel Access](#admin-panel-access)
9. [All CTF Flags](#all-ctf-flags)

---

## Overview

Blue Mountain Travel is an intentionally vulnerable travel agency application designed for security training. It contains multiple attack vectors including user enumeration, password spraying, insecure storage, and privilege escalation opportunities.

**Base URL**: http://localhost:8080

---

## User Enumeration & Password Spraying

### Vulnerability: Anonymous User Enumeration
- **Location**: `/js/enumeration.js`
- **Functions Available**:
  - `checkUserExists(email)` - Check if email exists in system
  - `enumerateAllUsers()` - List all emails without authentication
  - `getAllAzureUsernames()` - Get all Azure/Entra usernames

### Password Spraying Endpoints

#### 1. Application Password Spray
```javascript
attemptPasswordSpray(
  ["john.smith@company.com", "sarah.johnson@enterprise.com"], 
  "password123"
)
```
**Flag**: Find and decode the `ctf_b64:` marker for this exercise

#### 2. Database Password Spray
```javascript
attemptDatabasePasswordSpray(
  ["admin", "sa", "root"], 
  "P@ssw0rd123!"
)
```
**Flag**: Find and decode the `ctf_b64:` marker for this exercise

#### 3. Entra ID Password Spray
```javascript
attemptEntraPasswordSpray(
  ["john.smith@bluemountain.onmicrosoft.com"],
  "Winter2026!"
)
```
**Flag**: Find and decode the `ctf_b64:` marker for this exercise

### Known Valid Credentials

**Application Users**:
- john.smith@company.com / password123
-- sarah.johnson@globalind.com / Sarah@2026
-- michael.chen@innovlab.io / Chen#2026
- emma.w@consulting.com / Emma!Williams99
-- david.martinez@invbank.com / DavidM@rtinez2026
-- admin@bluemountaintravel.com / Admin@BlueMountain2026!

**Database**:
- Username: admin
- Password: P@ssw0rd123!
- Server: bluemountaintravel.database.windows.net

**Azure/Entra Admin**:
- Username: admin@bluemountain.onmicrosoft.com
- Password: AzureAdmin2026!@#
- Tenant: 87654321-4321-4321-4321-210987654321

---

## Authentication Vulnerabilities

### 1. Client-Side Authentication
- **Page**: `/login.html`
- **Vulnerability**: All authentication logic in JavaScript
- **Flag**: Find and decode the `ctf_b64:` marker for this exercise

### 2. No Rate Limiting
- **Issue**: Unlimited login attempts
- **Flag**: Find and decode the `ctf_b64:` marker for this exercise

### 3. User Existence Disclosure
- **Issue**: Different error messages for valid/invalid users
- **Flag**: Find and decode the `ctf_b64:` marker for this exercise

### 4. Plain Text Passwords
- **Storage**: localStorage, console logs, source code
- **Flag**: Find and decode the `ctf_b64:` marker for this exercise

---

## Azure Storage Exposure

### Public SAS Token
**Token**: Retrieved client-side via `window.AzureConfig.sasToken` (intentionally exposed for training)

**Permissions**: Full (Read, Write, Delete, List, Add, Create, Update, Process, Execute)
**Expiry**: 2025-12-31

### Accessible Containers

1. **passports** - Employee passport scans and photos
2. **profiles** - User profile data with PII
3. **bookings** - Travel booking confirmations
4. **documents** - Configuration files and credentials

### Storage Browser
- **URL**: http://localhost:8080/storage-browser.html
- **Flag**: Find and decode the `ctf_b64:` marker for this exercise

### Access Commands

```bash
# List all containers
az storage container list \
  --account-name bluemountaintravel \
  --sas-token "$AZURE_STORAGE_SAS_TOKEN"

# Download all passports
az storage blob download-batch \
  --account-name bluemountaintravel \
  --source passports \
  --destination ./passports \
  --sas-token "..."
```

---

## Passport Data Leakage

### Passport Viewer
- **URL**: http://localhost:8080/passport-viewer.html
- **Flag**: Find and decode the `ctf_b64:` marker for this exercise

### Available Passports

| Employee | Passport No | Country | Photo URL |
|----------|-------------|---------|-----------|
| John Smith | US123456789 | USA | With unsplash image |
| Sarah Johnson | US234567890 | USA | With unsplash image |
| Michael Chen | CN567890123 | China | With unsplash image |
| Emma Williams | GB789012345 | UK | With unsplash image |
| David Martinez | MX890123456 | Mexico | With unsplash image |
| Admin | US000000001 | USA (Diplomatic) | With unsplash image |

### Passport Files

Each passport has:
- Full passport PDF scan
- High-resolution passport photo (JPG)
- Both accessible via public SAS token URLs

**Flags**:
- Find and decode the `ctf_b64:` markers related to passport storage exposure

---

## Employee Database Exposure

### Access Employee Data
```javascript
// Search employees
searchEmployees("john")

// Export all employee data
exportEmployeeData()

// Get privileged accounts
getPrivilegedEmployees()

// Get Azure usernames for targeting
getAllAzureUsernames()
```

### Employee Data Includes
- Full name, email, personal email
- SSN, date of birth, salary
- Home address, phone numbers
- AD username, Azure username
- Security question answers
- VPN access status, access level

**Flags**:
- Find and decode the `ctf_b64:` markers related to the employee database exposure

---

## Lateral Movement Paths

### Path 1: Database â†’ Storage

1. Obtain database credentials (from source code or password spray)
2. Connect to SQL database
3. Query passport/booking tables with blob URLs
4. Use SAS tokens from database to download files

```javascript
lateralMovementFromDatabase()
```
**Flag**: Find and decode the `ctf_b64:` marker for this exercise

### Path 2: Service Principal â†’ Key Vault â†’ Storage

1. Find app-registrations.json in documents container
2. Extract service principal credentials:
   - App ID: a1b2c3d4-e5f6-7890-abcd-ef1234567890
   - Secret: SuperSecret123!@#$%
3. Use service principal to access Key Vault
4. Retrieve storage account keys from Key Vault
5. Full access to all storage containers

```javascript
accessPassportsViaKeyVault()
```
**Flag**: Find and decode the `ctf_b64:` marker for this exercise

### App Registration File
**URL**: http://localhost:8080/app-registrations.json
**Contains**:
- Service principal credentials
- Azure subscription details
- Key Vault access information
- Azure CLI commands with credentials

**Flags**:
- Find and decode the `ctf_b64:` markers related to app registrations and service principals

---

## Admin Panel Access

### URL
http://localhost:8080/admin.html

### Vulnerabilities
- No authentication required
- All credentials displayed in plain text
- Full user data export functionality
- Azure subscription access exposed

### Admin Functions
```javascript
showAzureCredentials()
showConnectionString()
viewAllUsers()
exportUserData()
showSASToken()
showServicePrincipalDetails()
```

### Exposed Information
- Azure Subscription ID
- Tenant ID
- Database connection strings
- Service principal secrets
- Storage SAS tokens
- API keys
- Entra ID global admin credentials

**Flags**:
- Find and decode the `ctf_b64:` markers related to the admin panel

---

## CTF Flag Checklist

This project still contains all training flags, but the raw strings are intentionally not published here.

To complete the challenge:
1. Find a `ctf_b64:` marker in source code, HTML comments, logs, or documents
2. Decode the base64 payload
3. Submit the decoded flag

For the full vulnerability catalog (locations + exploitation guidance), use:
- `docs/VULNERABILITIES_REFERENCE.md`

---

## Quick Start Guide

1. Start the application:
   ```bash
   npm install
   npm start
   ```

2. Open browser to http://localhost:8080

3. Key pages to explore:
   - `/login.html` - Vulnerable authentication
   - `/admin.html` - Exposed admin panel
   - `/passport-viewer.html` - Passport images
   - `/storage-browser.html` - Azure storage access
   - `/hotel-detail.html?id=HT001` - IDOR vulnerability

4. Open browser console (F12) and explore:
   - `window.sampleUsers` - All user data
   - `enumerateAllUsers()` - List all emails
   - `attemptPasswordSpray([...], "...")` - Test password spraying
   - `exportEmployeeData()` - Get employee PII
   - `listAllPassportUrls()` - Get passport download URLs

---

## Training Exercises

1. **Reconnaissance**: Find all exposed credentials in source code
2. **Password Spraying**: Use enumeration to build target list, then spray
3. **Lateral Movement**: Chain vulnerabilities (DB â†’ Storage â†’ Key Vault)
4. **Privilege Escalation**: Find admin credentials and access admin panel
5. **Data Exfiltration**: Download all passports and employee data
6. **Service Principal Abuse**: Use app registration to access Azure resources

---

**Remember**: This is an intentionally vulnerable application for training purposes only!
